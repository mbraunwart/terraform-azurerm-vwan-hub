<!-- TOC -->
<!-- /TOC -->

# Azure Enterprise Network Foundation Module

This Terraform module provides an enterprise-ready framework for creating and managing secure, scalable, and compliant Azure Virtual Networks (VNets). It simplifies the deployment of networking components, integrates with Azure DNS and security features, and supports various connectivity models for both cloud-only and hybrid scenarios.

## Purpose

The module’s main objective is to streamline the provisioning of Azure networking resources, ensuring they adhere to organizational standards for security and reliability. By packaging best practices into a reusable Terraform module, it reduces the overhead typically associated with large-scale or multi-environment VNet deployments.

## Key Capabilities

- **Configurable Network Security Groups (NSGs)**  
  Enforce default deny-all rules and introduce granular inbound/outbound control to align with zero-trust security principles.

- **Private DNS Zone Integration**  
  Seamlessly create and link private DNS zones to VNets for internal name resolution, supporting cross-region and cross-subscription scenarios.

- **Hub and Spoke or VHUB Peering**  
  Establish hub-and-spoke network topologies or connect to Azure Virtual WAN for centralized network management and traffic routing.

- **Azure Monitor and Logging Support**  
  Stream diagnostic logs and metrics to Azure Monitor and Log Analytics to capture traffic flows, NSG hits, and gateway diagnostics.

## Implementation Details

Beneath the surface, this module applies a “security-by-default” philosophy. Every subnet is created with an NSG that denies all inbound and outbound traffic unless explicitly permitted. Private endpoints can be deployed to securely connect to Azure PaaS services, while integrated private DNS ensures name resolution remains internal. Users can customize these behaviors through input variables, allowing the module to fit a broad range of enterprise requirements.

### Architecture Overview

The module supports traditional hub-and-spoke designs, where spokes isolate workloads while sharing centralized services in the hub, as well as mesh architectures that provide direct connectivity among all VNets. In hybrid scenarios, you can add an ExpressRoute or VPN Gateway to your network for secure connections to on-premises environments. To further simplify connectivity, the module can attach to Azure Virtual WAN when global or large-scale connectivity is needed.

### Best Practices

When deploying multiple VNets, plan out IP address ranges to avoid overlap, especially across different subscriptions or on-premises networks. Use Azure Policy to enforce tagging and logging standards so resources remain consistent. Apply role-based access control (RBAC) to minimize the blast radius of changes, and leverage Log Analytics for detailed monitoring. Finally, adopt the Azure Well-Architected Framework to guide decisions on performance, security, operational excellence, reliability, and cost optimization.

## Diagnostic Settings

Diagnostics can be configured to route logs to Log Analytics, Azure Storage, or Event Hubs. This includes flow logs for each NSG, which record traffic details and rule matches. By centralizing logs in Azure Monitor, you gain real-time visibility and can create actionable alerts that help teams respond quickly to network anomalies or security incidents.

## Known Limitations

Overlapping IP address spaces in complex networks may require additional planning. Cross-subscription deployments can fail without proper RBAC permissions. Latency in multi-region VNet peering depends on Azure’s global backbone, affecting highly latency-sensitive workloads. Lastly, ensure subscription and service quotas (e.g., number of VNets or peering links) are sufficient for large-scale rollouts.

## Usage Example

```hcl
module "vnet_advanced" {
  source = "github.com/example/terraform-azurerm-network"
  providers = {
    azurerm.prod   = azurerm.prod
    azurerm.shared = azurerm.shared
    azurerm        = azurerm
  }

  resource_group_name = "rg-advanced-network"
  vnet_name           = "vnet-advanced"
  vnet_address_prefixes = ["10.2.0.0/16"]

  subnets = [
    {
      name             = "snet-web"
      address_prefixes = ["10.2.1.0/24"]
      service_endpoints = ["Microsoft.Storage"]
    },
    {
      name             = "snet-db"
      address_prefixes = ["10.2.2.0/24"]
      delegation = {
        name = "db-delegation"
        service_delegation = {
          name    = "Microsoft.Sql/servers"
          actions = ["Microsoft.Network/virtualNetworks/subnets/action"]
        }
      }
    }
  ]

  log_analytics_workspace_id = "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/log-analytics/providers/Microsoft.OperationalInsights/workspaces/loganalytics"
}
```